<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cooking101 â€¢ Form</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<div class="site">

  <header>
    <div class="container header-inner">
      <a class="brand" href="index.html"><span class="logo"></span><span>Cooking101</span></a>
      <nav aria-label="Primary">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="breakfastpage.html">Breakfast</a></li>
          <li><a href="lunchpage.html">Lunch</a></li>
          <li><a href="dinnerpage.html">Dinner</a></li>
          <li><a href="dessertpage.html">Dessert</a></li>
          <li><a href="glossarypage.html">Glossary</a></li>
          <li><a href="formpage.html" class="active">Form</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="panel">
      <h2 class="section-title">Meal Suggestion</h2>
      <p class="meta" style="margin-bottom:16px">Share your ideas with us here</p>

      <!-- user info -->
      <form class="form" action="#" method="post">
        <div class="field">
          <label for="name">Your name</label>
          <input id="name" name="name" type="text" placeholder="Name here" required>
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input id="email" name="email" type="text" placeholder="you@example.com">
        </div>

        <!-- dish name -->
       <div class="field">
          <label for="dish">Dish name</label>
          <input id="dish" name="dish" type="text" placeholder="e.g., Cheesy Garlic Omelette" required>
        </div>

        <!-- image upload/link -->
        <div class="row">
          <div class="field">
            <label for="imageFile">Dish image (upload)</label>
            <input id="imageFile" name="imageFile" type="file" accept="image/*">
            <small class="subtle">Choose an image file. If both file and URL are provided, the file preview is shown.</small>
          </div>
          <div class="field">
            <label for="imageUrl">Dish image (URL)</label>
            <input id="imageUrl" name="imageUrl" type="text" placeholder="https://...">
            <small class="subtle">Paste an image link to preview below.</small>
          </div>
        </div>

        <div class="field" style="grid-column:1/-1">
          <img id="preview" class="img-preview" alt="Dish preview" src="" style="display:none;">
        </div>

        <!-- meal time -->
        <fieldset>
          <legend>Meal time</legend>
          <label><input type="radio" name="mealtime" value="breakfast" checked> Breakfast</label>
          <label><input type="radio" name="mealtime" value="lunch"> Lunch</label>
          <label><input type="radio" name="mealtime" value="dinner"> Dinner</label>
          <label><input type="radio" name="mealtime" value="dessert"> Dessert</label>
        </fieldset>


        <!-- ingredients -->
        <div class="repeatable" id="ingredients-section">
          <div class="compact" style="justify-content:space-between">
            <h3 style="margin:0">Ingredients</h3>
            <button type="button" class="ghostbtn" id="add-ingredient">+ Add ingredient</button>
          </div>
          <div class="list" id="ingredients-list"></div>
        </div>


        <!-- steps/process -->
        <div class="repeatable" id="steps-section">
          <div class="compact" style="justify-content:space-between">
            <h3 style="margin:0">Process (Step-by-step)</h3>
            <button type="button" class="ghostbtn" id="add-step">+ Add step</button>
          </div>
          <div class="list" id="steps-list"></div>
          <small class="subtle">Tip: Add the time for each step; we'll total it for you automatically.</small>
        </div>

        <!-- servings, notes -->
        <div class="field">
          <label for="servings">Servings</label>
          <input id="servings" name="servings" type="number" min="1" value="2">
        </div>

        <div class="field" style="grid-column:1/-1">
          <label for="notes">Notes / Allergies</label>
          <textarea id="notes" name="notes" placeholder="Anything we should know?"></textarea>
        </div>

        <div class="actions">
          <span class="totaltime">Total time: <span id="total-time">0</span> min</span>
          <button type="reset" class="btn-ghost">Reset</button>
          <button type="submit" class="btn-primary">Submit</button>
        </div>

        <!-- Templates -->
        <template id="ingredient-tpl">
          <div class="item ingredient">
            <div class="field wide">
              <label>Ingredient</label>
              <input type="text" name="ingredient_text[]" placeholder="e.g., List your ingredients" />
            </div>
            <button type="button" class="remove" aria-label="Remove ingredient">Remove</button>
          </div>
        </template>

        <template id="step-tpl">
          <div class="item step">
            <div class="field wide">
              <label>Step <span class="step-num"></span></label>
              <textarea name="step_desc[]" placeholder="Describe what to do..."></textarea>
            </div>
            <div class="field">
              <label>Time (minutes)</label>
              <input type="number" min="0" value="0" class="step-time" name="step_time[]" />
            </div>
            <button type="button" class="remove" aria-label="Remove step">Remove</button>
          </div>
        </template>

      </form>
    </section>
  </main>

  <footer>
    <div class="container"><small> Made by Aaron Medina.</small></div>
  </footer>

</div>

<!-- behavior -->
<script>
(function(){
  const form = document.getElementById('meal-form');

  /* ---- image upload/link ---- */
  const imgUrlInput = document.getElementById('imageUrl');
  const imgFileInput = document.getElementById('imageFile');
  const preview = document.getElementById('preview');
  let objectUrl = "";

  function showPreview(src){ if(preview){ preview.style.display = src ? 'block' : 'none'; preview.src = src || ""; } }
  function revokeObjectUrl(){ if(objectUrl){ URL.revokeObjectURL(objectUrl); objectUrl = ""; } }
  function updatePreviewFromUrl(){ if(imgFileInput && imgFileInput.files?.length) return; showPreview((imgUrlInput?.value || "").trim()); }
  function updatePreviewFromFile(){
    if(!imgFileInput) return;
    const file = imgFileInput.files?.[0];
    revokeObjectUrl();
    if(file){ objectUrl = URL.createObjectURL(file); showPreview(objectUrl); }
    else { updatePreviewFromUrl(); }
  }
  imgUrlInput && imgUrlInput.addEventListener('input', updatePreviewFromUrl);
  imgFileInput && imgFileInput.addEventListener('change', updatePreviewFromFile);

  /* ---- ingredients ---- */
  const ingList  = document.getElementById('ingredients-list');
  const ingTpl   = document.getElementById('ingredient-tpl');
  const addIngBtn= document.getElementById('add-ingredient');

  function addIngredient(text=''){
    const node = ingTpl.content.firstElementChild.cloneNode(true);
    const input = node.querySelector('input[name="ingredient_text[]"]');
    input.value = text;
    node.querySelector('.remove').addEventListener('click', () => node.remove());
    ingList.appendChild(node);
    input.focus();
  }
  addIngBtn.addEventListener('click', () => addIngredient());

  /* ---- steps/process ---- */
  const stepList   = document.getElementById('steps-list');
  const stepTpl    = document.getElementById('step-tpl');
  const addStepBtn = document.getElementById('add-step');
  const totalTimeEl= document.getElementById('total-time');

  function renumberSteps(){
    stepList.querySelectorAll('.item.step').forEach((el, i) => {
      const num = el.querySelector('.step-num');
      if(num) num.textContent = String(i + 1);
    });
  }
  function updateTotalTime(){
    let total = 0;
    stepList.querySelectorAll('.step-time').forEach(inp => {
      const v = parseInt(inp.value, 10);
      if(!isNaN(v)) total += v;
    });
    if(totalTimeEl) totalTimeEl.textContent = String(total);
  }
  function addStep(desc='', minutes=0){
    const node = stepTpl.content.firstElementChild.cloneNode(true);
    const ta   = node.querySelector('textarea[name="step_desc[]"]');
    const time = node.querySelector('input.step-time');
    ta.value = desc;
    time.value = minutes;

    time.addEventListener('input', updateTotalTime);
    node.querySelector('.remove').addEventListener('click', () => {
      node.remove();
      renumberSteps();
      updateTotalTime();
    });

    stepList.appendChild(node);
    renumberSteps();
    updateTotalTime();
    ta.focus();
  }

  // Enter on a minutes field adds the next step
  stepList.addEventListener('keydown', (e) => {
    if(e.target.matches && e.target.matches('.step-time') && e.key === 'Enter'){
      e.preventDefault();
      addStep();
    }
  });

  addStepBtn.addEventListener('click', () => addStep());

  /* ---- Initialize blank ingredient+step ---- */
  addIngredient();
  addStep();

  /* ---- reset ---- */
  form.addEventListener('reset', () => {
    setTimeout(() => {
      ingList.innerHTML = '';
      stepList.innerHTML = '';
      addIngredient();
      addStep();
      revokeObjectUrl();
      showPreview('');
      updateTotalTime();
    }, 0);
  });
})();
</script>

</body>
</html>
